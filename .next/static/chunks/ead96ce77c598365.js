(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52683,e=>{"use strict";var s=e.i(43476),t=e.i(71645);function a(){return(0,s.jsxs)("header",{className:"chat-header",children:[(0,s.jsx)("h1",{className:"chat-title",children:"AI WooCommerce Uploader"}),(0,s.jsx)("p",{className:"chat-subtitle",children:"Crea productos con inteligencia artificial"})]})}function i({loading:e,currentMessage:t,currentStep:a,input:i,setInput:r,handleSendMessage:n,handleSkip:o,error:l,uploadSuccess:c}){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"ai-message",children:(0,s.jsxs)("div",{className:"message-bubble",children:[e&&(0,s.jsxs)("div",{className:"loading-dots",children:[(0,s.jsx)("span",{}),(0,s.jsx)("span",{}),(0,s.jsx)("span",{})]}),(0,s.jsx)("p",{children:t})]})}),"complete"!==a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("form",{onSubmit:n,className:"chat-input-form",children:(0,s.jsxs)("div",{className:"input-container",children:[(0,s.jsx)("input",{type:"text",value:i,onChange:e=>r(e.target.value),placeholder:"Escribe tu respuesta...",className:"chat-input",disabled:e,autoFocus:!0}),(0,s.jsx)("button",{type:"submit",disabled:e||!i.trim(),className:"send-button","aria-label":"Enviar",children:(0,s.jsx)("svg",{className:"icon-send",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})}),(0,s.jsx)("button",{type:"button",className:"skip-button",onClick:o,disabled:e,children:"Saltar este paso"})]}),l&&(0,s.jsxs)("div",{className:"alert alert-error",children:[(0,s.jsx)("svg",{className:"icon-alert",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("p",{children:l})]}),c&&(0,s.jsxs)("div",{className:"alert alert-success",children:[(0,s.jsx)("svg",{className:"icon-alert",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,s.jsx)("p",{children:c})]})]})}let r={publish:"Publicado",draft:"Borrador",pending:"Pendiente",private:"Privado"};function n({result:e,downloadCSV:t,handleUpload:a,resetChat:i,uploading:n}){let o=e?.product;if(!o)return null;let l=o?.tags??[],c=o?.categories??[],d=o?.images??[],u=o?.status?r[o.status]??o.status:null,m=!!(o?.dimensions&&(o.dimensions.length||o.dimensions.width||o.dimensions.height));return(0,s.jsxs)("div",{className:"product-result",children:[(0,s.jsxs)("div",{className:"product-header",children:[(0,s.jsx)("svg",{className:"icon-product",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,s.jsx)("h3",{children:"Producto Generado"})]}),(0,s.jsxs)("div",{className:"product-details",children:[(0,s.jsxs)("div",{className:"product-name",children:[(0,s.jsx)("span",{className:"label",children:"Nombre"}),(0,s.jsx)("span",{className:"value",children:o.name})]}),(0,s.jsxs)("div",{className:"product-info-grid",children:[(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("span",{className:"label",children:"Precio"}),(0,s.jsxs)("div",{className:"price",children:[(0,s.jsx)("span",{className:"value",children:o.regular_price}),(0,s.jsx)("span",{className:"currency",children:"EUR"})]})]}),(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("span",{className:"label",children:"Categorías"}),(0,s.jsx)("div",{className:"categories",children:c.length>0?c.map((e,t)=>(0,s.jsx)("span",{className:"category-tag",children:e},t)):(0,s.jsx)("span",{className:"value",children:"Sin categorías"})})]}),(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("span",{className:"label",children:"Etiquetas"}),(0,s.jsx)("div",{className:"categories",children:l.length>0?l.map((e,t)=>(0,s.jsx)("span",{className:"category-tag",children:e},t)):(0,s.jsx)("span",{className:"value",children:"Sin etiquetas"})})]}),(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("span",{className:"label",children:"Stock"}),(0,s.jsx)("span",{className:"value",children:o.stock_quantity??"N/D"})]}),(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("span",{className:"label",children:"SKU"}),(0,s.jsx)("span",{className:"value",children:o.sku||"N/D"})]}),(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("span",{className:"label",children:"Estado"}),(0,s.jsx)("span",{className:"value",children:u||"N/D"})]}),(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("span",{className:"label",children:"Tipo"}),(0,s.jsx)("span",{className:"value",children:o.type||"simple"})]}),(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("span",{className:"label",children:"Peso"}),(0,s.jsx)("span",{className:"value",children:o.weight||"N/D"})]}),(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("span",{className:"label",children:"Dimensiones"}),(0,s.jsx)("span",{className:"value",children:m?[o.dimensions?.length,o.dimensions?.width,o.dimensions?.height].filter(e=>e).join(" x "):"N/D"})]})]}),o.attributes&&o.attributes.length>0&&(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("span",{className:"label",children:"Atributos"}),(0,s.jsx)("div",{className:"attributes",children:o.attributes.map((e,t)=>(0,s.jsxs)("div",{className:"attribute-tag",children:[(0,s.jsxs)("span",{className:"attr-name",children:[e.name,":"]}),(0,s.jsx)("span",{className:"attr-value",children:e.value})]},t))})]}),d.length>0&&(0,s.jsxs)("div",{className:"info-item",children:[(0,s.jsx)("span",{className:"label",children:"Imágenes"}),(0,s.jsx)("div",{className:"images-list",children:d.map((e,t)=>(0,s.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"image-link",children:["Imagen ",t+1]},e))})]})]}),(0,s.jsxs)("div",{className:"action-buttons",children:[(0,s.jsxs)("button",{onClick:t,className:"btn btn-secondary",children:[(0,s.jsx)("svg",{className:"btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})}),(0,s.jsx)("span",{children:"Descargar CSV"})]}),(0,s.jsx)("button",{onClick:a,disabled:n,className:"btn btn-primary",children:n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"btn-icon animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,s.jsx)("span",{children:"Subiendo..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{className:"btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,s.jsx)("span",{children:"Subir a WooCommerce"})]})}),(0,s.jsxs)("button",{onClick:i,className:"btn btn-secondary",children:[(0,s.jsx)("svg",{className:"btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,s.jsx)("span",{children:"Nuevo Producto"})]})]})]})}let o=(e,s={})=>e?Array.from(new Set(e.split(/[\n,]+/).flatMap(e=>s.allowHierarchy?e.split(">"):[e]).map(e=>e.trim()).filter(e=>e.length>0))):[],l=e=>{if(!e)return;let s=e.replace(/[^0-9.,-]/g,"").replace(",",".");if(!s)return;let t=parseFloat(s);if(Number.isFinite(t))return Math.max(0,Math.round(t))},c=["name","price","shortDescription","longDescription","category","tags","images","stock","sku","status","productType","shipping","attributes","complete"],d={name:"¿Cuál es el título del producto?",price:"¿Cuál es el precio?",shortDescription:"Dame una descripción corta.",longDescription:"Ahora una descripción más completa.",category:"¿En qué categoría lo metemos?",tags:"¿Quieres añadir etiquetas?",images:"¿Qué imágenes quieres usar? (URL o generar con IA)",stock:"¿Cuánto stock tiene?",sku:"¿Cuál es el SKU?",status:"¿Publicamos el producto o lo dejamos como borrador?",productType:"¿Qué tipo de producto es? (simple por defecto)",shipping:"Dame detalles de envío: peso y dimensiones",attributes:"¿Tiene atributos como color, talla o material?"},u={name:"",price:"",shortDescription:"",longDescription:"",category:"",tags:"",images:"",stock:"",sku:"",status:"",productType:"",shippingDetails:"",attributes:""},m="Voy a ayudarte a crear un producto nuevo. Empecemos por lo básico. ¿Cuál es el título del producto?";function p(){let[e,r]=(0,t.useState)(""),[p,h]=(0,t.useState)("name"),[g,x]=(0,t.useState)(m),[j,N]=(0,t.useState)(u),[b,v]=(0,t.useState)(!1),[f,k]=(0,t.useState)(null),[y,D]=(0,t.useState)(""),[w,C]=(0,t.useState)(!1),[S,L]=(0,t.useState)(""),A=e=>{let s=c.indexOf(e);return c[s+1]||"complete"},M=async(e,s)=>{"complete"===e?(x("¡Perfecto! Estoy generando tu producto con toda la información..."),v(!0),await E(s)):(h(e),x(d[e]))},T=async s=>{if(s.preventDefault(),b)return;let t=e.trim();if(!t)return;r("");let a={...j};switch(p){case"name":a.name=t;break;case"price":a.price=t;break;case"shortDescription":a.shortDescription=t;break;case"longDescription":a.longDescription=t;break;case"category":a.category=t;break;case"tags":a.tags=t;break;case"images":a.images=t;break;case"stock":a.stock=t;break;case"sku":a.sku=t;break;case"status":a.status=t;break;case"productType":a.productType=t;break;case"shipping":a.shippingDetails=t;break;case"attributes":a.attributes=t}N(a);let i=A(p);await M(i,a)},P=async()=>{if(b||"complete"===p)return;let e=A(p);r(""),await M(e,j)},E=async e=>{D(""),k(null),L("");try{let s=o(e.category,{allowHierarchy:!0}),t=o(e.tags),a=o(e.images),i=l(e.stock),r=(e=>{let s=e.trim().toLowerCase();if(!s)return;if(s.includes("borrador")||s.includes("draft"))return"draft";if(s.includes("pend"))return"pending";if(s.includes("priv"))return"private";let t=s.replace(/[^a-záéíóúüñ\s]/g," ").split(/\s+/).filter(Boolean);if(s.includes("public")||s.includes("activar")||t.includes("si")||t.includes("sí"))return"publish"})(e.status),n=e.productType.trim().toLowerCase()||"simple",c=(e=>{let s;if(!e.trim())return{};let t=e=>{let s=e.replace(/[^0-9.,-]/g,"").replace(",",".");if(!s)return;let t=parseFloat(s);return Number.isFinite(t)?t:void 0},a=e=>{let s=Math.round(1e3*e)/1e3;return Number.isInteger(s)?String(s):s.toString()},i=e.match(/peso\s*: ?([\d.,]+)\s*([a-zA-Z]*)/i)||e.match(/weight\s*: ?([\d.,]+)\s*([a-zA-Z]*)/i);if(i){let e=t(i[1]);void 0!==e&&(s=a((i[2]||"").toLowerCase().startsWith("g")?e/1e3:e))}let r={},n=e.match(/dimensiones?\s*: ?([\d.,]+)\s*[xX]\s*([\d.,]+)\s*[xX]\s*([\d.,]+)/);if(n){let e=t(n[1]),s=t(n[2]),i=t(n[3]);void 0!==e&&(r.length=a(e)),void 0!==s&&(r.width=a(s)),void 0!==i&&(r.height=a(i))}else{let s=e.match(/(largo|longitud|length)\s*: ?([\d.,]+)/i),i=e.match(/(ancho|width)\s*: ?([\d.,]+)/i),n=e.match(/(alto|altura|height)\s*: ?([\d.,]+)/i);if(s){let e=t(s[2]);void 0!==e&&(r.length=a(e))}if(i){let e=t(i[2]);void 0!==e&&(r.width=a(e))}if(n){let e=t(n[2]);void 0!==e&&(r.height=a(e))}}return{weight:s,dimensions:Object.values(r).some(Boolean)?r:void 0}})(e.shippingDetails),d=(e=>{if(!e.trim())return[];let s=e.split(/[\n;]+/).flatMap(e=>e.split(",")).map(e=>e.trim()).filter(e=>e.length>0),t=new Map;return s.forEach(e=>{let[s,a]=e.split(/[:=|-]/).map(e=>e.trim());if(!s||!a)return;let i=s.toLowerCase();t.has(i)||t.set(i,{name:s,value:a,visible:!0,variation:!1})}),Array.from(t.values())})(e.attributes),u=e.images.toLowerCase().includes("generar");u&&(a=[]);let m=`T\xedtulo sugerido: ${e.name||"N/D"}
Precio indicado: ${e.price||"N/D"}
Descripci\xf3n corta: ${e.shortDescription||"N/D"}
Descripci\xf3n completa: ${e.longDescription||"N/D"}
Categor\xedas propuestas: ${s.length?s.join(" | "):e.category||"N/D"}
Etiquetas sugeridas: ${t.length?t.join(", "):e.tags||"N/D"}
Im\xe1genes proporcionadas: ${u?"El usuario prefiere generarlas con IA.":a.length?a.join(", "):e.images||"N/D"}
Stock indicado: ${e.stock||"N/D"}
SKU indicado: ${e.sku||"N/D"}
Estado deseado: ${r||e.status||"N/D"}
Tipo de producto: ${e.productType||"simple"}
Detalles de env\xedo: ${e.shippingDetails||"N/D"}
Atributos sugeridos: ${e.attributes||"N/D"}`,p={};e.name.trim()&&(p.name=e.name.trim()),e.shortDescription.trim()&&(p.short_description=e.shortDescription.trim()),e.longDescription.trim()&&(p.description=e.longDescription.trim()),e.price.trim()&&(p.regular_price=e.price.trim()),s.length&&(p.categories=s),t.length&&(p.tags=t),a.length&&(p.images=a),"number"==typeof i&&(p.stock_quantity=i),e.sku.trim()&&(p.sku=e.sku.trim()),r&&(p.status=r),p.type=n,c.weight&&(p.weight=c.weight),c.dimensions&&(p.dimensions=c.dimensions),d.length&&(p.attributes=d);let g=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:m,overrides:p})});if(!g.ok)throw Error("Failed to generate product");let j=await g.json(),N=(e=>{if(!e?.product)return e;let s=e.product,t=Array.isArray(s.categories)?s.categories:o(String(s.categories??""),{allowHierarchy:!0}),a=Array.isArray(s.tags)?s.tags:o(String(s.tags??"")),i=Array.isArray(s.images)?s.images:o(String(s.images??"")),r="number"==typeof s.stock_quantity?s.stock_quantity:l(String(s.stock_quantity??""));return{...e,product:{...s,categories:t,tags:a,images:i,stock_quantity:r??void 0,attributes:Array.isArray(s.attributes)?s.attributes:[]}}})(j);k(N),x(`✅ \xa1Producto generado exitosamente! "${N.product.name}" est\xe1 listo.`),h("complete")}catch(e){D("Ocurrió un error al generar el producto. Por favor, inténtalo de nuevo."),x("❌ Lo siento, hubo un error al generar el producto. Recarga la página para intentarlo de nuevo."),console.error(e)}finally{v(!1)}},B=async()=>{if(f?.product){C(!0),L(""),D("");try{let e=await fetch("/api/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product:f.product})}),s=await e.json();if(!e.ok)throw Error(s.error||"Failed to upload product");L("¡Producto subido a WooCommerce con éxito!")}catch(e){D(e.message||"Error al subir el producto")}finally{C(!1)}}};return(0,s.jsx)("main",{className:"chat-container",children:(0,s.jsxs)("div",{className:"chat-wrapper",children:[(0,s.jsx)(a,{}),(0,s.jsxs)("div",{className:"chat-content",children:[(0,s.jsx)(i,{loading:b,currentMessage:g,currentStep:p,input:e,setInput:r,handleSendMessage:T,handleSkip:P,error:y,uploadSuccess:S}),f&&"complete"===p&&(0,s.jsx)(n,{result:f,downloadCSV:()=>{if(!f?.csv)return;let e=new Blob([f.csv],{type:"text/csv"}),s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="products.csv",t.click()},handleUpload:B,resetChat:()=>{x(m),h("name"),N(u),k(null),D(""),L(""),r("")},uploading:w})]})]})})}e.s(["default",()=>p],52683)}]);