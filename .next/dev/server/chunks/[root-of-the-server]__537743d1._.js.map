{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jose/.gemini/antigravity/scratch/ai-woo-uploader/src/lib/schema.ts"],"sourcesContent":["import { z } from 'zod';\r\n\r\n// Define the schema for a WooCommerce Product based on standard CSV import columns\r\nexport const ProductSchema = z.object({\r\n    name: z.string().describe(\"The name of the product\"),\r\n    short_description: z.string().optional().describe(\"A short summary of the product\"),\r\n    description: z.string().optional().describe(\"Full details of the product\"),\r\n    regular_price: z.string().optional().describe(\"The normal price of the product\"),\r\n    sale_price: z.string().optional().describe(\"The discounted price of the product, if any\"),\r\n    stock_quantity: z.number().optional().describe(\"Number of items in stock\"),\r\n    categories: z.array(z.string()).default([]).describe(\"List of categories the product belongs to\"),\r\n    tags: z.array(z.string()).default([]).describe(\"List of tags for the product\"),\r\n    images: z.array(z.string()).default([]).describe(\"List of image URLs\"),\r\n    sku: z.string().optional().describe(\"Stock Keeping Unit\"),\r\n    status: z.enum([\"draft\", \"pending\", \"private\", \"publish\"]).optional().describe(\"Publication status in WooCommerce\"),\r\n    type: z.string().optional().describe(\"WooCommerce product type\"),\r\n    weight: z.string().optional().describe(\"Product weight\"),\r\n    dimensions: z.object({\r\n        length: z.string().optional(),\r\n        width: z.string().optional(),\r\n        height: z.string().optional(),\r\n    }).optional().describe(\"Product dimensions\"),\r\n    attributes: z.array(z.object({\r\n        name: z.string(),\r\n        value: z.string(),\r\n        visible: z.boolean().default(true),\r\n        variation: z.boolean().default(true)\r\n    })).default([]).describe(\"Product attributes like Size, Color, etc.\"),\r\n});\r\n\r\nexport type Product = z.infer<typeof ProductSchema>;\r\n"],"names":[],"mappings":";;;;AAAA;;AAGO,MAAM,gBAAgB,oLAAC,CAAC,MAAM,CAAC;IAClC,MAAM,oLAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1B,mBAAmB,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IAClD,aAAa,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IAC5C,eAAe,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IAC9C,YAAY,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IAC3C,gBAAgB,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IAC/C,YAAY,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,MAAM,IAAI,OAAO,CAAC,EAAE,EAAE,QAAQ,CAAC;IACrD,MAAM,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,MAAM,IAAI,OAAO,CAAC,EAAE,EAAE,QAAQ,CAAC;IAC/C,QAAQ,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,MAAM,IAAI,OAAO,CAAC,EAAE,EAAE,QAAQ,CAAC;IACjD,KAAK,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IACpC,QAAQ,oLAAC,CAAC,IAAI,CAAC;QAAC;QAAS;QAAW;QAAW;KAAU,EAAE,QAAQ,GAAG,QAAQ,CAAC;IAC/E,MAAM,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IACrC,QAAQ,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IACvC,YAAY,oLAAC,CAAC,MAAM,CAAC;QACjB,QAAQ,oLAAC,CAAC,MAAM,GAAG,QAAQ;QAC3B,OAAO,oLAAC,CAAC,MAAM,GAAG,QAAQ;QAC1B,QAAQ,oLAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,GAAG,QAAQ,GAAG,QAAQ,CAAC;IACvB,YAAY,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,MAAM,CAAC;QACzB,MAAM,oLAAC,CAAC,MAAM;QACd,OAAO,oLAAC,CAAC,MAAM;QACf,SAAS,oLAAC,CAAC,OAAO,GAAG,OAAO,CAAC;QAC7B,WAAW,oLAAC,CAAC,OAAO,GAAG,OAAO,CAAC;IACnC,IAAI,OAAO,CAAC,EAAE,EAAE,QAAQ,CAAC;AAC7B"}},
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jose/.gemini/antigravity/scratch/ai-woo-uploader/src/lib/llm.ts"],"sourcesContent":["import OpenAI from 'openai';\r\nimport { ProductSchema, Product } from './schema';\r\nimport dotenv from 'dotenv';\r\n\r\ndotenv.config();\r\n\r\nconst openai = new OpenAI({\r\n    apiKey: process.env.OPENAI_API_KEY,\r\n});\r\n\r\nexport async function parseProductDescription(text: string): Promise<Product | null> {\r\n    try {\r\n        const completion = await openai.chat.completions.create({\r\n            model: \"gpt-4o\",\r\n            messages: [\r\n                {\r\n                    role: \"system\",\r\n                    content: `You are an expert e-commerce assistant. Extract product details from the user's description into a structured JSON object that matches the following schema:\r\n          \r\n          {\r\n            \"name\": \"string\",\r\n            \"short_description\": \"string\",\r\n            \"description\": \"string\",\r\n            \"regular_price\": \"string\",\r\n            \"sale_price\": \"string\",\r\n            \"stock_quantity\": number,\r\n            \"categories\": [\"string\"],\r\n            \"tags\": [\"string\"],\r\n            \"images\": [\"string\"],\r\n            \"attributes\": [{\"name\": \"string\", \"value\": \"string\", \"visible\": boolean, \"variation\": boolean}]\r\n          }\r\n\r\n          Infer missing details where reasonable. Ensure the response is valid JSON.`\r\n                },\r\n                { role: \"user\", content: text },\r\n            ],\r\n            response_format: { type: \"json_object\" },\r\n        });\r\n\r\n        const content = completion.choices[0].message.content;\r\n        if (!content) return null;\r\n\r\n        const parsed = JSON.parse(content);\r\n        // Validate with Zod\r\n        const product = ProductSchema.parse(parsed);\r\n        return product;\r\n    } catch (error) {\r\n        console.error(\"Error parsing product description:\", error);\r\n        return null;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AACA;;;;AAEA,kJAAM,CAAC,MAAM;AAEb,MAAM,SAAS,IAAI,mLAAM,CAAC;IACtB,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACtC;AAEO,eAAe,wBAAwB,IAAY;IACtD,IAAI;QACA,MAAM,aAAa,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpD,OAAO;YACP,UAAU;gBACN;oBACI,MAAM;oBACN,SAAS,CAAC;;;;;;;;;;;;;;;oFAesD,CAAC;gBACrE;gBACA;oBAAE,MAAM;oBAAQ,SAAS;gBAAK;aACjC;YACD,iBAAiB;gBAAE,MAAM;YAAc;QAC3C;QAEA,MAAM,UAAU,WAAW,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;QACrD,IAAI,CAAC,SAAS,OAAO;QAErB,MAAM,SAAS,KAAK,KAAK,CAAC;QAC1B,oBAAoB;QACpB,MAAM,UAAU,uIAAa,CAAC,KAAK,CAAC;QACpC,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,sCAAsC;QACpD,OAAO;IACX;AACJ"}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jose/.gemini/antigravity/scratch/ai-woo-uploader/src/lib/csv.ts"],"sourcesContent":["import { stringify } from 'csv-stringify/sync';\r\nimport { Product } from './schema';\r\n\r\nexport function generateCSV(products: Product[]): string {\r\n    // Map our internal Product schema to WooCommerce CSV columns\r\n    const records = products.map(p => {\r\n        const record: any = {\r\n            'Type': 'simple',\r\n            'SKU': '', // Could generate a random SKU if needed\r\n            'Name': p.name,\r\n            'Published': 1,\r\n            'Is featured?': 0,\r\n            'Visibility in catalog': 'visible',\r\n            'Short description': p.short_description || '',\r\n            'Description': p.description || '',\r\n            'Date sale price starts': '',\r\n            'Date sale price ends': '',\r\n            'Tax status': 'taxable',\r\n            'Tax class': '',\r\n            'In stock?': p.stock_quantity ? 1 : 0,\r\n            'Stock': p.stock_quantity || 0,\r\n            'Backorders allowed?': 0,\r\n            'Sold individually?': 0,\r\n            'Weight (kg)': '',\r\n            'Length (cm)': '',\r\n            'Width (cm)': '',\r\n            'Height (cm)': '',\r\n            'Allow customer reviews?': 1,\r\n            'Purchase note': '',\r\n            'Sale price': p.sale_price || '',\r\n            'Regular price': p.regular_price || '',\r\n            'Categories': p.categories.join(', '),\r\n            'Tags': p.tags ? p.tags.join(', ') : '',\r\n            'Shipping class': '',\r\n            'Images': p.images ? p.images.join(', ') : '',\r\n            'Parent': '',\r\n        };\r\n\r\n        // Handle Attributes (WooCommerce expects specific column names like \"Attribute 1 name\", \"Attribute 1 value(s)\")\r\n        if (p.attributes) {\r\n            p.attributes.forEach((attr, index) => {\r\n                const i = index + 1;\r\n                record[`Attribute ${i} name`] = attr.name;\r\n                record[`Attribute ${i} value(s)`] = attr.value;\r\n                record[`Attribute ${i} visible`] = attr.visible ? 1 : 0;\r\n                record[`Attribute ${i} global`] = 1;\r\n            });\r\n        }\r\n\r\n        return record;\r\n    });\r\n\r\n    return stringify(records, {\r\n        header: true\r\n    });\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAGO,SAAS,YAAY,QAAmB;IAC3C,6DAA6D;IAC7D,MAAM,UAAU,SAAS,GAAG,CAAC,CAAA;QACzB,MAAM,SAAc;YAChB,QAAQ;YACR,OAAO;YACP,QAAQ,EAAE,IAAI;YACd,aAAa;YACb,gBAAgB;YAChB,yBAAyB;YACzB,qBAAqB,EAAE,iBAAiB,IAAI;YAC5C,eAAe,EAAE,WAAW,IAAI;YAChC,0BAA0B;YAC1B,wBAAwB;YACxB,cAAc;YACd,aAAa;YACb,aAAa,EAAE,cAAc,GAAG,IAAI;YACpC,SAAS,EAAE,cAAc,IAAI;YAC7B,uBAAuB;YACvB,sBAAsB;YACtB,eAAe;YACf,eAAe;YACf,cAAc;YACd,eAAe;YACf,2BAA2B;YAC3B,iBAAiB;YACjB,cAAc,EAAE,UAAU,IAAI;YAC9B,iBAAiB,EAAE,aAAa,IAAI;YACpC,cAAc,EAAE,UAAU,CAAC,IAAI,CAAC;YAChC,QAAQ,EAAE,IAAI,GAAG,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ;YACrC,kBAAkB;YAClB,UAAU,EAAE,MAAM,GAAG,EAAE,MAAM,CAAC,IAAI,CAAC,QAAQ;YAC3C,UAAU;QACd;QAEA,gHAAgH;QAChH,IAAI,EAAE,UAAU,EAAE;YACd,EAAE,UAAU,CAAC,OAAO,CAAC,CAAC,MAAM;gBACxB,MAAM,IAAI,QAAQ;gBAClB,MAAM,CAAC,CAAC,UAAU,EAAE,EAAE,KAAK,CAAC,CAAC,GAAG,KAAK,IAAI;gBACzC,MAAM,CAAC,CAAC,UAAU,EAAE,EAAE,SAAS,CAAC,CAAC,GAAG,KAAK,KAAK;gBAC9C,MAAM,CAAC,CAAC,UAAU,EAAE,EAAE,QAAQ,CAAC,CAAC,GAAG,KAAK,OAAO,GAAG,IAAI;gBACtD,MAAM,CAAC,CAAC,UAAU,EAAE,EAAE,OAAO,CAAC,CAAC,GAAG;YACtC;QACJ;QAEA,OAAO;IACX;IAEA,OAAO,IAAA,8JAAS,EAAC,SAAS;QACtB,QAAQ;IACZ;AACJ"}},
    {"offset": {"line": 234, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jose/.gemini/antigravity/scratch/ai-woo-uploader/src/app/api/generate/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { parseProductDescription } from '@/lib/llm';\r\nimport { generateCSV } from '@/lib/csv';\r\nimport { Product } from '@/lib/schema';\r\n\r\ntype Overrides = Partial<Pick<Product,\r\n    'name' |\r\n    'short_description' |\r\n    'description' |\r\n    'regular_price' |\r\n    'sale_price' |\r\n    'sku' |\r\n    'status' |\r\n    'type' |\r\n    'weight'\r\n>> & {\r\n    categories?: string[];\r\n    tags?: string[];\r\n    images?: string[];\r\n    stock_quantity?: number;\r\n    attributes?: Product['attributes'];\r\n    dimensions?: Product['dimensions'];\r\n};\r\n\r\nconst mergeOverrides = (product: Product, overrides?: Overrides): Product => {\r\n    if (!overrides) return product;\r\n\r\n    const sanitizeList = (value?: string[]): string[] | undefined => {\r\n        if (!value) return undefined;\r\n        const filtered = value.map((item) => item.trim()).filter((item) => item.length > 0);\r\n        if (filtered.length === 0) return undefined;\r\n        return Array.from(new Set(filtered));\r\n    };\r\n\r\n    const sanitizedCategories = sanitizeList(overrides.categories);\r\n    const sanitizedTags = sanitizeList(overrides.tags);\r\n    const sanitizedImages = sanitizeList(overrides.images);\r\n    const sanitizedAttributes = overrides.attributes && overrides.attributes.length > 0\r\n        ? overrides.attributes.filter((attr) => attr.name && attr.value)\r\n        : undefined;\r\n    const sanitizedDimensions = overrides.dimensions && (\r\n        overrides.dimensions.length || overrides.dimensions.width || overrides.dimensions.height\r\n    )\r\n        ? {\r\n              length: overrides.dimensions.length,\r\n              width: overrides.dimensions.width,\r\n              height: overrides.dimensions.height,\r\n          }\r\n        : undefined;\r\n    const sanitizedWeight = overrides.weight?.trim();\r\n    const sanitizedSku = overrides.sku?.trim();\r\n    const allowedStatuses: Product['status'][] = ['draft', 'pending', 'private', 'publish'];\r\n    const sanitizedStatus = overrides.status\r\n        ? (overrides.status.trim().toLowerCase() as Product['status'])\r\n        : undefined;\r\n    const statusValue = sanitizedStatus && allowedStatuses.includes(sanitizedStatus) ? sanitizedStatus : undefined;\r\n    const sanitizedType = overrides.type?.trim().toLowerCase();\r\n\r\n    return {\r\n        ...product,\r\n        ...(overrides.name ? { name: overrides.name } : {}),\r\n        ...(overrides.short_description ? { short_description: overrides.short_description } : {}),\r\n        ...(overrides.description ? { description: overrides.description } : {}),\r\n        ...(overrides.regular_price ? { regular_price: overrides.regular_price } : {}),\r\n        ...(overrides.sale_price ? { sale_price: overrides.sale_price } : {}),\r\n        ...(sanitizedCategories ? { categories: sanitizedCategories } : {}),\r\n        ...(sanitizedTags ? { tags: sanitizedTags } : {}),\r\n        ...(sanitizedImages ? { images: sanitizedImages } : {}),\r\n        ...(sanitizedSku ? { sku: sanitizedSku } : {}),\r\n        ...(statusValue ? { status: statusValue } : {}),\r\n        ...(sanitizedType ? { type: sanitizedType } : {}),\r\n        ...(sanitizedWeight ? { weight: sanitizedWeight } : {}),\r\n        ...(sanitizedDimensions ? { dimensions: sanitizedDimensions } : {}),\r\n        ...(sanitizedAttributes ? { attributes: sanitizedAttributes } : {}),\r\n        ...(overrides.stock_quantity !== undefined ? { stock_quantity: overrides.stock_quantity } : {}),\r\n    };\r\n};\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const body = await request.json();\r\n        const { text, overrides } = body as { text?: string; overrides?: Overrides };\r\n\r\n        if (!text) {\r\n            return NextResponse.json({ error: 'Text is required' }, { status: 400 });\r\n        }\r\n\r\n        const product = await parseProductDescription(text);\r\n\r\n        if (!product) {\r\n            return NextResponse.json({ error: 'Failed to parse product' }, { status: 500 });\r\n        }\r\n\r\n        const finalProduct = mergeOverrides(product, overrides);\r\n        const csv = generateCSV([finalProduct]);\r\n\r\n        return NextResponse.json({ product: finalProduct, csv });\r\n    } catch (error) {\r\n        console.error('API Error:', error);\r\n        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}