# Configuración de Nginx para Múltiples Aplicaciones
# Este archivo muestra cómo configurar n8n y AI Woo Uploader juntos

# ============================================
# OPCIÓN 1: SUBDOMINIOS (Recomendado)
# ============================================

# n8n - Configuración existente (ejemplo)
# /etc/nginx/sites-available/n8n
server {
    listen 80;
    listen [::]:80;
    server_name n8n.tudominio.com;

    location / {
        proxy_pass http://localhost:5678;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}

# AI Woo Uploader - Nueva configuración
# /etc/nginx/sites-available/ai-woo-uploader
server {
    listen 80;
    listen [::]:80;
    server_name app.tudominio.com;  # O el subdominio que prefieras

    access_log /var/log/nginx/ai-woo-uploader-access.log;
    error_log /var/log/nginx/ai-woo-uploader-error.log;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # Next.js static files
    location /_next/static {
        proxy_pass http://localhost:3000;
        proxy_cache_valid 60m;
        add_header Cache-Control "public, max-age=3600, immutable";
    }
}

# ============================================
# OPCIÓN 2: RUTAS (Alternativa)
# ============================================

# Servidor principal con múltiples rutas
# /etc/nginx/sites-available/multi-app
server {
    listen 80;
    listen [::]:80;
    server_name tudominio.com;

    # n8n en /n8n
    location /n8n/ {
        proxy_pass http://localhost:5678/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        
        # Reescribir rutas
        rewrite ^/n8n/(.*) /$1 break;
    }

    # AI Woo Uploader en /app
    location /app/ {
        proxy_pass http://localhost:3000/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        
        # Reescribir rutas
        rewrite ^/app/(.*) /$1 break;
    }

    # Raíz - puedes redirigir a una de las apps
    location / {
        return 301 /app;
    }
}

# ============================================
# COMANDOS PARA ACTIVAR
# ============================================

# Para OPCIÓN 1 (Subdominios):
# sudo ln -s /etc/nginx/sites-available/ai-woo-uploader /etc/nginx/sites-enabled/
# sudo nginx -t
# sudo systemctl reload nginx

# Para OPCIÓN 2 (Rutas):
# sudo ln -s /etc/nginx/sites-available/multi-app /etc/nginx/sites-enabled/
# sudo nginx -t
# sudo systemctl reload nginx

# ============================================
# SSL (Después de configurar DNS)
# ============================================

# Para subdominios:
# sudo certbot --nginx -d n8n.tudominio.com -d app.tudominio.com

# Para dominio principal:
# sudo certbot --nginx -d tudominio.com -d www.tudominio.com
